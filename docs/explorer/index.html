<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Electricity Price Explorer â€“ Compare and Analyze EU & Nordic Prices | Utilitarian Spot</title>
    <meta name="description"
        content="Explore and compare historical and dayâ€‘ahead electricity prices across EU and Nordic zones. Select multiple areas, set a date range, and generate shareable links. Data in UTC from ENTSOâ€‘E. Free, fast, and reliable for analysis and automation." />
    <meta name="keywords"
        content="electricity prices explorer, energy price comparison, EU electricity prices, Nordic electricity prices, dayâ€‘ahead prices, historical electricity data, ENTSOâ€‘E, SE1, SE2, SE3, SE4, DK1, DK2, NO1, NO2, NO3, NO4, NO5, FI, DE_LU, AT, FR, BE, NL, PL, EE, LT, LV, IT North, Spain ES, Portugal PT" />
    <meta property="og:title" content="Electricity Price Explorer â€“ Compare EU & Nordic Prices" />
    <meta property="og:description"
        content="Interactive explorer for EU/Nordic electricity prices. Compare multiple zones, pick date ranges, and share results. UTC timestamps; â‚¬/MWh; data from ENTSOâ€‘E." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://spot.utilitarian.io/explorer/" />
    <meta property="og:site_name" content="Utilitarian Spot" />
    <meta property="og:image" content="https://spot.utilitarian.io/assets/images/social-card-explorer.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Comparison chart illustrating electricity prices with Utilitarian Spot branding." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Electricity Price Explorer â€“ Compare EU & Nordic Prices" />
    <meta name="twitter:description"
        content="Interactive explorer for EU/Nordic electricity prices. Compare multiple zones, pick date ranges, and share results." />
    <meta name="twitter:image" content="https://spot.utilitarian.io/assets/images/social-card-explorer.png" />
    <meta name="twitter:image:alt" content="Comparison chart illustrating electricity prices with Utilitarian Spot branding." />

    <link rel="icon" type="image/png" href="/assets/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Spot" />
    <link rel="manifest" href="/assets/favicon/site.webmanifest" />
    <meta name="theme-color" content="#0f172a" />



    <link rel="canonical" href="https://spot.utilitarian.io/explorer/" />
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/uplot@1.6.24/dist/uPlot.min.css"
        onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uplot@1.6.24/dist/uPlot.min.css" />
    </noscript>
    <script defer src="https://cdn.jsdelivr.net/npm/uplot@1.6.24/dist/uPlot.iife.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="bg-white">
    <header class="bg-slate-900/95 text-slate-100 backdrop-blur border-t border-white/10 fixed inset-x-0 bottom-0 z-40 sm:bg-white/90 sm:text-slate-600 sm:sticky sm:top-0 sm:bottom-auto sm:border-b sm:border-t-0 sm:border-slate-200">
        <nav class="mx-auto flex w-full max-w-6xl items-center gap-4 px-4 py-3 text-sm font-semibold text-slate-100 sm:text-slate-600">
            <a href="/" class="hidden sm:flex items-baseline shrink-0 font-display text-2xl font-semibold tracking-tight text-slate-900">
                <span class="mr-2">Utilitarian</span>
                <span class="relative whitespace-nowrap text-green-600">
                    <svg aria-hidden="true" viewBox="0 0 418 42"
                        class="absolute top-2/3 left-0 h-[0.6em] w-full fill-green-300/70" preserveAspectRatio="none">
                        <path
                            d="M203.371.916c-26.013-2.078-76.686 1.963-124.73 9.946L67.3 12.749C35.421 18.062 18.2 21.766 6.004 25.934 1.244 27.561.828 27.778.874 28.61c.07 1.214.828 1.121 9.595-1.176 9.072-2.377 17.15-3.92 39.246-7.496C123.565 7.986 157.869 4.492 195.942 5.046c7.461.108 19.25 1.696 19.17 2.582-.107 1.183-7.874 4.31-25.75 10.366-21.992 7.45-35.43 12.534-36.701 13.884-2.173 2.308-.202 4.407 4.442 4.734 2.654.187 3.263.157 15.593-.78 35.401-2.686 57.944-3.488 88.365-3.143 46.327.526 75.721 2.23 130.788 7.584 19.787 1.924 20.814 1.98 24.557 1.332l.066-.011c1.201-.203 1.53-1.825.399-2.335-2.911-1.31-4.893-1.604-22.048-3.261-57.509-5.556-87.871-7.36-132.059-7.842-23.239-.254-33.617-.116-50.627.674-11.629.54-42.371 2.494-46.696 2.967-2.359.259 8.133-3.625 26.504-9.81 23.239-7.825 27.934-10.149 28.304-14.005.417-4.348-3.529-6-16.878-7.066Z">
                        </path>
                    </svg>
                    <span class="relative">Spot</span>
                </span>
            </a>
            <div class="flex flex-1 items-center justify-around gap-4 sm:justify-center sm:gap-6">
                <a href="/" class="text-slate-200 hover:text-white sm:text-slate-600 sm:hover:text-slate-900">Latest Prices</a>
                <a href="/explorer/" class="text-white hover:text-white sm:text-slate-900 sm:hover:text-slate-900">Historical Explorer</a>
                <a href="/developer/" class="text-slate-200 hover:text-white sm:text-slate-600 sm:hover:text-slate-900">Developer</a>
            </div>
        </nav>
    </header>
    <div class="sm:hidden bg-white/95 backdrop-blur border-b border-slate-200">
        <a href="/" class="mx-auto flex w-full max-w-6xl items-baseline justify-center gap-2 px-4 py-3 font-display text-lg font-semibold text-slate-900">
            <span>Utilitarian</span>
            <span class="relative whitespace-nowrap text-green-600">
                <svg aria-hidden="true" viewBox="0 0 418 42"
                    class="absolute top-2/3 left-0 h-[0.5em] w-full fill-green-300/70" preserveAspectRatio="none">
                    <path
                        d="M203.371.916c-26.013-2.078-76.686 1.963-124.73 9.946L67.3 12.749C35.421 18.062 18.2 21.766 6.004 25.934 1.244 27.561.828 27.778.874 28.61c.07 1.214.828 1.121 9.595-1.176 9.072-2.377 17.15-3.92 39.246-7.496C123.565 7.986 157.869 4.492 195.942 5.046c7.461.108 19.25 1.696 19.17 2.582-.107 1.183-7.874 4.31-25.75 10.366-21.992 7.45-35.43 12.534-36.701 13.884-2.173 2.308-.202 4.407 4.442 4.734 2.654.187 3.263.157 15.593-.78 35.401-2.686 57.944-3.488 88.365-3.143 46.327.526 75.721 2.23 130.788 7.584 19.787 1.924 20.814 1.98 24.557 1.332l.066-.011c1.201-.203 1.53-1.825.399-2.335-2.911-1.31-4.893-1.604-22.048-3.261-57.509-5.556-87.871-7.36-132.059-7.842-23.239-.254-33.617-.116-50.627.674-11.629.54-42.371 2.494-46.696 2.967-2.359.259 8.133-3.625 26.504-9.81 23.239-7.825 27.934-10.149 28.304-14.005.417-4.348-3.529-6-16.878-7.066Z">
                    </path>
                </svg>
                <span class="relative">Spot</span>
            </span>
        </a>
    </div>
    <main class="mx-auto max-w-6xl px-2 sm:px-4 lg:px-8 pt-8 pb-24 sm:py-8" x-data="explorer()" x-init="init()">
        <h1 class="text-2xl font-semibold text-slate-900 text-center">Electricity Price Explorer</h1>


        <div class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div>
                <label class="block mb-2 text-sm text-slate-600">Zones</label>
                <div class="grid grid-cols-2 gap-3">
                    <!-- Available zones -->
                    <div class="rounded-md border border-slate-300">
                        <div class="px-3 py-2 border-b border-slate-200 text-xs font-medium text-slate-600">Available
                        </div>
                        <div class="max-h-40 overflow-auto py-1">
                            <template x-for="z in availableZones()" :key="z.code">
                                <button type="button" @click="addZone(z.code)"
                                    class="w-full text-left px-3 py-1.5 text-sm hover:bg-slate-50 flex items-center gap-2">
                                    <span x-text="z.flag"></span>
                                    <span class="font-medium" x-text="z.code"></span>
                                </button>
                            </template>
                        </div>
                    </div>

                    <!-- Selected zones -->
                    <div class="rounded-md border border-slate-300">
                        <div class="px-3 py-2 border-b border-slate-200 text-xs font-medium text-slate-600">Selected
                        </div>
                        <div class="max-h-40 overflow-auto py-1">
                            <template x-for="code in selectedZones" :key="code">
                                <button type="button" @click="removeZone(code)"
                                    class="w-full text-left px-3 py-1.5 text-sm hover:bg-slate-50 flex items-center gap-2">
                                    <span x-text="zoneByCode(code)?.flag || ''"></span>
                                    <span class="font-medium" x-text="code"></span>
                                </button>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <label class="block mb-1 text-sm text-slate-600" for="from-date">From</label>
                <input id="from-date" type="date" x-model="fromDate" @change="onDateChange"
                    class="rounded-md border border-slate-300 px-3 py-2 text-sm w-full" />
            </div>
            <div>
                <label class="block mb-1 text-sm text-slate-600" for="to-date">To</label>
                <input id="to-date" type="date" x-model="toDate" @change="onDateChange"
                    class="rounded-md border border-slate-300 px-3 py-2 text-sm w-full" />
            </div>
        </div>

        <div class="mt-3 flex flex-wrap items-center justify-between gap-3">
            <div class="flex flex-wrap items-center gap-2">
                <button @click="setPrevMonth" type="button"
                    class="rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50">Last
                    month</button>
                <button @click="setPrevYear" type="button"
                    class="rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50">Last
                    year</button>
                <template x-for="y in quickYears" :key="y">
                    <button @click="setYear(y)" type="button"
                        class="rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50"
                        x-text="y"></button>
                </template>
            </div>
            <div class="flex items-center gap-2 relative">
                <button @click="downloadCSV" type="button"
                    class="inline-flex items-center gap-2 rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50">
                    <!-- Heroicons outline: arrow-down-tray -->
                    <svg class="w-4 h-4 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M7.5 12 12 16.5m0 0L16.5 12M12 16.5V3" />
                    </svg>
                    Download CSV
                </button>
                <button @click="openShare" type="button"
                    class="inline-flex items-center gap-2 rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50">
                    <!-- Heroicons outline: rectangle-stack -->
                    <svg class="w-4 h-4 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z" />
                    </svg>


                    Share
                </button>
                <div x-show="shareOpen" @click.away="shareOpen=false"
                    class="absolute right-0 z-10 mt-2 w-72 rounded-md border border-slate-200 bg-white p-3 shadow-lg"
                    x-transition>
                    <label class="block text-xs text-slate-600 mb-1" for="share-url-input">Shareable URL</label>
                    <div class="flex items-center gap-2">
                        <input id="share-url-input" type="text" :value="shareUrl" readonly
                            class="w-full rounded-md border border-slate-300 px-2 py-1 text-xs text-slate-700">
                        <button @click="copyShare" type="button"
                            class="rounded-md border border-slate-300 p-1.5 hover:bg-slate-50">
                            <template x-if="!shareCopied">
                                <!-- Heroicons outline: clipboard-document -->
                                <svg class="w-4 h-4 text-slate-700" xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M9 7.5h6M8.25 3.75h7.5A2.25 2.25 0 0 1 18 6v12a2.25 2.25 0 0 1-2.25 2.25H8.25A2.25 2.25 0 0 1 6 18V6A2.25 2.25 0 0 1 8.25 3.75z" />
                                </svg>
                            </template>
                            <template x-if="shareCopied">
                                <!-- Heroicons outline: check -->
                                <svg class="w-4 h-4 text-green-600" xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                </svg>
                            </template>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Collapsible pricing settings -->
        <div class="mt-3">
            <button type="button" @click="settingsOpen = !settingsOpen"
                class="inline-flex items-center gap-2 rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50">
                <svg class="w-4 h-4 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M8.25 3v8.25M8.25 12.75V21M15.75 3v3.75M15.75 9.75V21M12 3v12M12 16.5V21" />
                </svg>
                Pricing settings
            </button>
            <div x-show="settingsOpen" x-transition class="mt-2 rounded-md border border-slate-200 p-3">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                    <div>
                        <label class="block mb-1 text-sm text-slate-600" for="currency-code-input">Currency code</label>
                        <input id="currency-code-input" type="text" x-model="currencyCode" @change="onSettingsChange"
                            placeholder="EUR" maxlength="6"
                            class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm uppercase" />
                    </div>
                    <div>
                        <label class="block mb-1 text-sm text-slate-600" for="currency-rate-input">1 â‚¬ equals</label>
                        <input id="currency-rate-input" type="number" step="0.0001" min="0"
                            x-model.number="currencyRate" @change="onSettingsChange"
                            class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm" />
                    </div>
                    <div>
                        <label class="block mb-1 text-sm text-slate-600" for="unit-select">Energy unit</label>
                        <select id="unit-select" x-model="unit" @change="onSettingsChange"
                            class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm">
                            <option value="MWh">MWh</option>
                            <option value="kWh">kWh</option>
                        </select>
                    </div>
                </div>
                <div class="mt-3">
                    <button type="button" @click="clearSettings"
                        class="rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50">Clear
                        settings</button>
                </div>
                <p class="mt-2 text-xs text-slate-600">Axis and values use <span x-text="currencyCode"></span>/<span
                        x-text="unit"></span>. Conversion factor: <span x-text="currencyRate"></span> per â‚¬ and 1/1000
                    for kWh.</p>
            </div>
        </div>

        <div class="my-8"
            :class="chartFullScreen ? 'fixed inset-0 z-50 bg-white px-4 py-6 sm:px-8 sm:py-6 overflow-auto' : ''"
            @keydown.window.escape="chartFullScreen && toggleFullScreen(false)">
            <div class="flex justify-end mb-3">
                <button type="button" @click="toggleFullScreen()"
                    class="inline-flex items-center gap-2 rounded-md border border-slate-300 px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50 shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-600" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
                    </svg>
                    <span x-text="chartFullScreen ? 'Exit full screen' : 'Full screen'"></span>
                </button>
            </div>
            <div id="explorerChart" class="relative w-full h-64 sm:h-80 lg:h-96"
                :style="chartFullScreen ? 'height: calc(100vh - 6rem); max-height: none;' : ''"></div>
        </div>
    </main>

    <script>
        function explorer() {
            const ZONES = [
                { code: 'SE1', flag: 'ðŸ‡¸ðŸ‡ª' }, { code: 'SE2', flag: 'ðŸ‡¸ðŸ‡ª' }, { code: 'SE3', flag: 'ðŸ‡¸ðŸ‡ª' }, { code: 'SE4', flag: 'ðŸ‡¸ðŸ‡ª' },
                { code: 'DK1', flag: 'ðŸ‡©ðŸ‡°' }, { code: 'DK2', flag: 'ðŸ‡©ðŸ‡°' },
                { code: 'NO1', flag: 'ðŸ‡³ðŸ‡´' }, { code: 'NO2', flag: 'ðŸ‡³ðŸ‡´' }, { code: 'NO3', flag: 'ðŸ‡³ðŸ‡´' }, { code: 'NO4', flag: 'ðŸ‡³ðŸ‡´' }, { code: 'NO5', flag: 'ðŸ‡³ðŸ‡´' },
                { code: 'FI', flag: 'ðŸ‡«ðŸ‡®' },
                { code: 'DE_LU', flag: 'ðŸ‡©ðŸ‡ª' },
                { code: 'AT', flag: 'ðŸ‡¦ðŸ‡¹' }, { code: 'FR', flag: 'ðŸ‡«ðŸ‡·' }, { code: 'BE', flag: 'ðŸ‡§ðŸ‡ª' }, { code: 'NL', flag: 'ðŸ‡³ðŸ‡±' }, { code: 'PL', flag: 'ðŸ‡µðŸ‡±' },
                { code: 'EE', flag: 'ðŸ‡ªðŸ‡ª' }, { code: 'LT', flag: 'ðŸ‡±ðŸ‡¹' }, { code: 'LV', flag: 'ðŸ‡±ðŸ‡»' },
                { code: 'IT-NORTH', flag: 'ðŸ‡®ðŸ‡¹' }, { code: 'IT-CENTRE_NORTH', flag: 'ðŸ‡®ðŸ‡¹' }, { code: 'IT-CENTRE_SOUTH', flag: 'ðŸ‡®ðŸ‡¹' }, { code: 'IT-SOUTH', flag: 'ðŸ‡®ðŸ‡¹' }, { code: 'IT-SICILY', flag: 'ðŸ‡®ðŸ‡¹' }, { code: 'IT-SARDINIA', flag: 'ðŸ‡®ðŸ‡¹' }, { code: 'IT-CALABRIA', flag: 'ðŸ‡®ðŸ‡¹' },
                { code: 'CH', flag: 'ðŸ‡¨ðŸ‡­' }, { code: 'ES', flag: 'ðŸ‡ªðŸ‡¸' }, { code: 'PT', flag: 'ðŸ‡µðŸ‡¹' },
                { code: 'SK', flag: 'ðŸ‡¸ðŸ‡°' }, { code: 'SI', flag: 'ðŸ‡¸ðŸ‡®' }, { code: 'CZ', flag: 'ðŸ‡¨ðŸ‡¿' }, { code: 'HU', flag: 'ðŸ‡­ðŸ‡º' }, { code: 'HR', flag: 'ðŸ‡­ðŸ‡·' },
                { code: 'RO', flag: 'ðŸ‡·ðŸ‡´' }, { code: 'RS', flag: 'ðŸ‡·ðŸ‡¸' }, { code: 'BG', flag: 'ðŸ‡§ðŸ‡¬' }, { code: 'GR', flag: 'ðŸ‡¬ðŸ‡·' }
            ];

            return {
                allZones: ZONES,
                selectedZones: [],
                fromDate: '',
                toDate: '',
                chart: null,
                _resizeObs: null,
                shareOpen: false,
                shareCopied: false,
                shareUrl: '',
                settingsOpen: false,
                currencyCode: 'EUR',
                currencyRate: 1,
                unit: 'MWh',
                quickYears: [],
                _exportX: [],
                _exportSeriesY: [],
                _exportLabels: [],
                chartFullScreen: false,
                _cleanupFullScreen: null,
                init() {
                    const params = new URLSearchParams(location.search);
                    const parseCsv = (v) => (v ? v.split(',').map(s => s.trim()).filter(Boolean) : []);
                    document.body.classList.remove('overflow-hidden');

                    // Default last 30 days (UTC)
                    const todayUtc = new Date();
                    const toIso = d => new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate())).toISOString().slice(0, 10);
                    const end = new Date(Date.UTC(todayUtc.getUTCFullYear(), todayUtc.getUTCMonth(), todayUtc.getUTCDate()));
                    const start = new Date(end);
                    start.setUTCDate(start.getUTCDate() - 30);

                    const urlFrom = params.get('from');
                    const urlTo = params.get('to');
                    const urlZones = parseCsv(params.get('zones'));

                    this.fromDate = urlFrom || localStorage.getItem('explorer.from') || toIso(start);
                    this.toDate = urlTo || localStorage.getItem('explorer.to') || toIso(end);

                    if (urlZones.length) {
                        this.selectedZones = urlZones;
                    } else {
                        try {
                            const saved = JSON.parse(localStorage.getItem('explorer.zones') || '[]');
                            if (Array.isArray(saved) && saved.length) this.selectedZones = saved;
                        } catch { }
                    }
                    if (this.selectedZones.length === 0) this.selectedZones = ['SE1', 'SE2', 'SE3', 'SE4'];

                    // parse settings from URL/localStorage
                    const uCur = (params.get('cur') || localStorage.getItem('explorer.cur') || 'EUR').toUpperCase();
                    const uRate = parseFloat(params.get('rate') || localStorage.getItem('explorer.rate') || '1') || 1;
                    const uUnit = (params.get('unit') || localStorage.getItem('explorer.unit') || 'MWh');
                    this.currencyCode = uCur;
                    this.currencyRate = uRate;
                    this.unit = (uUnit === 'kWh' ? 'kWh' : 'MWh');

                    this.syncUrl();
                    // Ensure the multi-select visually reflects the restored selections
                    this.$nextTick(() => this.syncSelectUI());
                    // build quick year buttons for previous 5 full years
                    const now = new Date();
                    const curY = now.getUTCFullYear();
                    this.quickYears = [curY - 1, curY - 2, curY - 3, curY - 4, curY - 5];
                    this.render();
                    this._cleanupFullScreen = () => document.body.classList.remove('overflow-hidden');
                    window.addEventListener('beforeunload', this._cleanupFullScreen);
                    window.addEventListener('pagehide', this._cleanupFullScreen);
                },
                zoneByCode(code) {
                    return this.allZones.find(z => z.code === code);
                },
                availableZones() {
                    const selected = new Set(this.selectedZones);
                    return this.allZones.filter(z => !selected.has(z.code));
                },
                addZone(code) {
                    if (!this.selectedZones.includes(code)) {
                        this.selectedZones = [...this.selectedZones, code];
                        this.onZonesChange();
                    }
                },
                removeZone(code) {
                    this.selectedZones = this.selectedZones.filter(c => c !== code);
                    this.onZonesChange();
                },
                onZonesChange() {
                    localStorage.setItem('explorer.zones', JSON.stringify(this.selectedZones));
                    this.syncUrl();
                    this.render();
                },
                onDateChange() {
                    localStorage.setItem('explorer.from', this.fromDate);
                    localStorage.setItem('explorer.to', this.toDate);
                    this.syncUrl();
                    this.render();
                },
                syncSelectUI() {
                    const sel = this.$refs.zonesSelect;
                    if (!sel) return;
                    const selected = new Set(this.selectedZones);
                    for (const opt of sel.options) {
                        opt.selected = selected.has(opt.value);
                    }
                },
                syncUrl() {
                    const params = new URLSearchParams();
                    if (this.selectedZones.length) params.set('zones', this.selectedZones.join(','));
                    if (this.fromDate) params.set('from', this.fromDate);
                    if (this.toDate) params.set('to', this.toDate);
                    if (this.currencyCode) params.set('cur', this.currencyCode.toUpperCase());
                    if (this.currencyRate != null) params.set('rate', String(this.currencyRate));
                    if (this.unit) params.set('unit', this.unit);
                    const newUrl = `${location.pathname}?${params.toString()}`;
                    history.replaceState(null, '', newUrl);
                    this.shareUrl = (location.origin || 'https://spot.utilitarian.io') + newUrl;
                },
                onSettingsChange() {
                    // normalize
                    this.currencyCode = (this.currencyCode || 'EUR').toUpperCase();
                    if (!isFinite(this.currencyRate) || this.currencyRate <= 0) this.currencyRate = 1;
                    if (this.unit !== 'kWh') this.unit = 'MWh';
                    localStorage.setItem('explorer.cur', this.currencyCode);
                    localStorage.setItem('explorer.rate', String(this.currencyRate));
                    localStorage.setItem('explorer.unit', this.unit);
                    this.syncUrl();
                    this.render();
                },
                clearSettings() {
                    this.currencyCode = 'EUR';
                    this.currencyRate = 1;
                    this.unit = 'MWh';
                    this.onSettingsChange();
                },
                setYear(y) {
                    const start = new Date(Date.UTC(y, 0, 1));
                    const end = new Date(Date.UTC(y, 11, 31));
                    const toIso = d => new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate())).toISOString().slice(0, 10);
                    this.fromDate = toIso(start);
                    this.toDate = toIso(end);
                    this.onDateChange();
                },
                getYAxisLabel() {
                    return `${this.currencyCode}/${this.unit}`;
                },
                setPrevMonth() {
                    const today = new Date();
                    const end = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate()));
                    const start = new Date(end);
                    start.setUTCMonth(start.getUTCMonth() - 1);
                    const toIso = d => new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate())).toISOString().slice(0, 10);
                    this.fromDate = toIso(start);
                    this.toDate = toIso(end);
                    this.onDateChange();
                },
                setPrevYear() {
                    const today = new Date();
                    const end = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate()));
                    const start = new Date(end);
                    start.setUTCFullYear(start.getUTCFullYear() - 1);
                    const toIso = d => new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate())).toISOString().slice(0, 10);
                    this.fromDate = toIso(start);
                    this.toDate = toIso(end);
                    this.onDateChange();
                },
                openShare() {
                    this.syncUrl();
                    this.shareOpen = !this.shareOpen;
                    this.shareCopied = false;
                },
                async copyShare() {
                    try {
                        await navigator.clipboard.writeText(this.shareUrl);
                        this.shareCopied = true;
                        setTimeout(() => { this.shareCopied = false; }, 1500);
                    } catch (_) { }
                },
                buildOpts(getWidth, getHeight, seriesDefs) {
                    return {
                        title: null,
                        width: getWidth(),
                        height: getHeight(),
                        legend: { show: false },
                        series: [
                            {},
                            ...seriesDefs.map(s => ({ label: s.label, stroke: s.color, width: 2, paths: uPlot.paths.stepped({ align: -1 }) }))
                        ],
                        axes: [
                            {
                                label: 'Time (UTC)',
                                values: (u, vals) => {
                                    let lastYear = null;
                                    let lastDay = null;
                                    return vals.map(v => {
                                        const d = new Date(v * 1000);
                                        const year = d.getUTCFullYear();
                                        const day = d.getUTCDate();
                                        const isMidnight = d.getUTCHours() === 0 && d.getUTCMinutes() === 0;
                                        let out;
                                        if (lastYear === null || year !== lastYear) {
                                            out = String(year);
                                        } else if (lastDay === null || day !== lastDay || isMidnight) {
                                            out = d.toLocaleDateString('en-GB', { month: 'short', day: '2-digit', timeZone: 'UTC' });
                                        } else {
                                            out = d.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' });
                                        }
                                        lastYear = year;
                                        lastDay = day;
                                        return out;
                                    });
                                },
                                grid: { show: true }
                            },
                            { label: this.getYAxisLabel(), grid: { show: true } }
                        ],
                        scales: { x: { time: true } },
                        cursor: { show: true, x: true, y: true, points: { show: false } },
                        hooks: {
                            init: [(u) => {
                                const tt = document.createElement('div');
                                tt.className = 'absolute z-10 rounded-md bg-slate-900/90 text-white text-xs px-2 py-1 shadow-lg pointer-events-none hidden';
                                tt.style.transform = 'translate(12px, -24px)';
                                u.over.appendChild(tt);
                                u._tt = tt;
                                u.over.addEventListener('mouseleave', () => tt.classList.add('hidden'));
                                u._seriesDefs = seriesDefs;
                            }],
                            setCursor: [(u) => {
                                const tt = u._tt; if (!tt) return;
                                const { left, top, idx } = u.cursor;
                                if (left == null || top == null || idx == null || left < 0 || top < 0 || left > u.bbox.width || top > u.bbox.height) {
                                    tt.classList.add('hidden'); return;
                                }
                                const xArr = u.data[0];
                                const i = Math.max(0, Math.min(idx, xArr.length - 1));
                                const d = new Date(xArr[i] * 1000);
                                const ts = d.toLocaleString('en-GB', { timeZone: 'UTC', year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false });
                                let html = `${ts} UTC`;
                                for (let s = 1; s < u.data.length; s++) {
                                    const val = u.data[s][i];
                                    const def = u._seriesDefs[s - 1];
                                    const label = def?.label || `S${s}`;
                                    const color = def?.color || '#999';
                                    const valStr = val == null ? 'â€”' : `${val.toFixed(2)} ${this.getYAxisLabel()}`;
                                    html += `<br><span style="display:inline-block;width:10px;height:10px;background:${color};border-radius:2px;margin-right:6px"></span>${label}: <span class="font-semibold">${valStr}</span>`;
                                }
                                tt.innerHTML = html; tt.style.left = `${left}px`; tt.style.top = `${top}px`; tt.classList.remove('hidden');
                            }]
                        }
                    };
                },
                async render() {
                    const el = document.getElementById('explorerChart');
                    const getWidth = () => el.getBoundingClientRect().width;
                    const getHeight = () => el.getBoundingClientRect().height;

                    const toTs = (d) => Math.floor(new Date(d).getTime() / 1000);
                    const startTs = toTs(this.fromDate + 'T00:00:00Z');
                    const endTs = toTs(this.toDate + 'T23:59:59Z');

                    try {
                        const t0 = performance.now();
                        // Fetch full-year data for each selected zone across the span
                        const neededYears = new Set();
                        const startYear = new Date(this.fromDate).getUTCFullYear();
                        const endYear = new Date(this.toDate).getUTCFullYear();
                        for (let y = startYear; y <= endYear; y++) neededYears.add(y);

                        const fetches = [];
                        for (const z of this.selectedZones) {
                            for (const y of neededYears) {
                                fetches.push(fetch(`/electricity/${z}/${y}/index.json`).then(r => r.ok ? r.json() : []));
                            }
                        }
                        const results = await Promise.all(fetches);

                        // Group back per-zone
                        const zoneToItems = new Map();
                        let idx = 0;
                        for (const z of this.selectedZones) {
                            const items = [];
                            for (const y of neededYears) { items.push(...results[idx++]); }
                            zoneToItems.set(z, items);
                        }

                        // Build union timeline filtered by range
                        const tsSet = new Set();
                        for (const items of zoneToItems.values()) {
                            for (const it of items) {
                                const ts = Math.floor(new Date(it.timestamp).getTime() / 1000);
                                if (ts >= startTs && ts <= endTs) tsSet.add(ts);
                            }
                        }
                        const xTimes = Array.from(tsSet).sort((a, b) => a - b);

                        // Align series
                        const colors = ['#059669', '#2563eb', '#f59e0b', '#dc2626', '#7c3aed', '#0ea5e9', '#16a34a'];
                        const seriesDefs = this.selectedZones.map((z, i) => ({ label: z, color: colors[i % colors.length] }));
                        const factor = (this.currencyRate || 1) * (this.unit === 'kWh' ? 1 / 1000 : 1);
                        const rawSeriesY = this.selectedZones.map(z => {
                            const m = new Map(zoneToItems.get(z).map(it => [Math.floor(new Date(it.timestamp).getTime() / 1000), parseFloat(String(it.value).replace(',', '.')) * factor]));
                            return xTimes.map(t => (m.has(t) ? m.get(t) : null));
                        });

                        const seriesY = rawSeriesY.map(series => {
                            let last = null;
                            return series.map(val => {
                                if (val == null) return last;
                                last = val;
                                return val;
                            });
                        });

                        // cache for CSV export
                        this._exportX = xTimes;
                        this._exportSeriesY = seriesY;
                        this._exportLabels = this.selectedZones.slice();

                        if (this._resizeObs) { try { this._resizeObs.disconnect(); } catch { } }
                        if (this.chart) this.chart.destroy();
                        this.chart = new uPlot(this.buildOpts(getWidth, getHeight, seriesDefs), [xTimes, ...seriesY], el);

                        this._resizeObs = new ResizeObserver(() => {
                            if (this.chart) this.chart.setSize({ width: getWidth(), height: getHeight() });
                        });
                        this._resizeObs.observe(el);
                        console.log('explorerRender:', (performance.now() - t0).toFixed(2), 'ms');

                        // datapoints log
                        const perSeriesCounts = seriesY.map(a => a.reduce((acc, v) => acc + (v == null ? 0 : 1), 0));
                        const totalPoints = perSeriesCounts.reduce((a, b) => a + b, 0);
                        console.log('explorer datapoints:', { xLen: xTimes.length, perSeries: this.selectedZones.map((z, i) => ({ zone: z, points: perSeriesCounts[i] })), total: totalPoints });
                    } catch (e) {
                        el.innerHTML = '<p class="text-center text-red-600">Error loading data.</p>';
                        console.error('explorer', e);
                    }
                },
                toggleFullScreen(force) {
                    const next = typeof force === 'boolean' ? force : !this.chartFullScreen;
                    if (this.chartFullScreen === next) return;
                    this.chartFullScreen = next;
                    document.body.classList.toggle('overflow-hidden', next);
                    this.$nextTick(() => {
                        if (this.chart) {
                            const el = document.getElementById('explorerChart');
                            if (el) {
                                const rect = el.getBoundingClientRect();
                                this.chart.setSize({ width: rect.width, height: rect.height });
                            }
                        }
                    });
                },
                downloadCSV() {
                    if (!this._exportX.length) return;
                    const headers = ['timestamp', ...this._exportLabels.map(z => `${z}(${this.currencyCode}/${this.unit})`)];
                    const rows = [];
                    for (let i = 0; i < this._exportX.length; i++) {
                        const ts = new Date(this._exportX[i] * 1000).toISOString();
                        const vals = this._exportSeriesY.map(col => {
                            const v = col[i];
                            return v == null ? '' : v.toFixed(2);
                        });
                        rows.push([ts, ...vals].join(','));
                    }
                    const csv = [headers.join(','), ...rows].join('\n');
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const zonesPart = this._exportLabels.join('-');
                    const fileName = `prices_${this.fromDate}_to_${this.toDate}_${zonesPart}.csv`;
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    URL.revokeObjectURL(url);
                }
            }
        }
    </script>

    <footer class="bg-slate-50 mt-16">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="py-16 text-center text-sm text-slate-600">

                <p>
                    Utilitarian Spot is a free, fast and reliable energy price backend for load control and demand
                    response automation. <br>
                    It provides day-ahead and historical energy price data, with simple charts for visualization when
                    needed.
                </p>
                <br>
                <p class="my-2">
                    Source data is reused from the
                    <a href="https://transparency.entsoe.eu" class="text-slate-900 font-semibold hover:text-slate-700" target="_blank" rel="noopener noreferrer">
                        ENTSO-E Transparency Platform
                    </a>
                    under the terms of CC BY 4.0.
                </p>
                <p class="my-2">Time is in UTC and prices are in â‚¬/MWh.</p>
            </div>
            <div
                class="flex flex-col items-center border-t border-slate-400/10 py-10 sm:flex-row-reverse sm:justify-between">
                <div class="flex gap-x-6">
                    <a class="group" aria-label="Utilitarian on GitHub" href="https://github.com/u9n/">
                        <svg aria-hidden="true" class="h-6 w-6 fill-slate-500 group-hover:fill-slate-700">
                            <path
                                d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844a9.59 9.59 0 0 1 2.504.337c1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.02 10.02 0 0 0 22 12.017C22 6.484 17.522 2 12 2Z">
                            </path>
                        </svg>
                    </a>
                </div>
                <p class="mt-6 text-sm text-slate-600 sm:mt-0">
                    Free service from <a class="text-slate-800 hover:text-slate-900 underline underline-offset-2"
                        href="https://utilitarian.io">utilitarian.io</a>
                </p>
            </div>
        </div>
    </footer>
    <div class="bg-slate-900 text-slate-300 text-xs py-6">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 text-center leading-relaxed">
            Disclaimer: data is collected from ENTSO-E and provided on a best-effort basis without guarantees of accuracy, completeness, or availability. Utilitarian Spot offers no service-level agreement and accepts no liability for losses or damages resulting from use of the data or service interruptions.
        </div>
    </div>


</body>

</html>
